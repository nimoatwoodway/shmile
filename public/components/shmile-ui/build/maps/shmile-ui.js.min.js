{"version":3,"sources":["shmile-ui.js"],"names":["CameraUtils","snap","idx","cheeseCb","p","zoomFrame","modalMessage","Config","ready_delay","scale4x6","maxw","maxh","s0","s1","w","h","photo_margin","window_width","$","window","width","window_height","height","overlay_delay","next_delay","cheese_delay","flash_duration","nice_delay","between_snap_delay","is_mobile","AppState","this","reset","prototype","current_frame_idx","zoomed","ShmileStateMachine","photoView","socket","appState","config","buttonView","self","isPrinting","fsm","StateMachine","create","initial","events","name","from","to","callbacks","onconnected","animate","onenterready","resetState","onleaveready","onenterwaiting_for_photo","e","flashStart","emit","fallback","setTimeout","console","log","flashEnd","modalMessageBig","location","reload","onphoto_saved","f","t","data","clearTimeout","updatePhotoSet","web_url","photo_updated","onphoto_updated","finish_set","continue_partial_set","onenterreview_composited","showOverlay","next_set","onleavereview_composited","bind","unbind","printtext","remove","onchangestate","SocketProxy","fakeSocket","_","extend","Backbone","Events","lateInitialize","on","evt","cb","msg","trigger","SocketLayer","io","proxy","init","connect","register","connected","filename","photo_saved","document","click","PhotoView","View","id","initialize","state","canvas","Raphael","frames","set","images","all","overlayImage","photoBorder","compositeDim","frameDim","compositeOrigin","compositeCenter","render","x","y","r","rect","attr","fill","push","frame_x","frame_y","frame","img","image","clone","translate","o","hide","toString","ret","length","join","img_src","view","imgEl","frameEl","src","opacity","show","afterShowPhoto","dir","translation","onfinish","frameX","frameW","frameY","frameH","centerX","centerY","animSpeed","dx","dy","scaleFactor","scale","slideInNext","flashEffect","duration","undefined","text","persistTime","animateSpeed","fontSize","sideLength","fill-opacity","stroke-color","txt","font-size","font-weight","hideOverlay","ButtonView","ui_button_pressed","fadeIn","ready","socketProxy","bv","ssm","layer"],"mappings":"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","file":"../js/shmile-ui.js","sourcesContent":["/**\n * A class of utility methods.\n */\n var CameraUtils = function() {};\n\n/**\n * Play the snap effect.\n * @param {Integer} idx\n *   The frame index to place the updated image.\n * @param {Function} cheeseCB\n *   Code to execute after \"Cheese\" is displayed.\n *   Typically, this wraps the command to fire the shutter.\n */\nCameraUtils.snap = function(idx, cheeseCb) {\n  p.zoomFrame(idx, 'in');\n  // These guys need to be promises.\n  p.modalMessage('Bereit?', Config.ready_delay, 200, function() {\n    p.modalMessage(\"3\", 1000, 200, function() {\n      p.modalMessage(\"2\", 1000, 200,  function() {\n        p.modalMessage(\"1\", 1000, 200, function() {\n          cheeseCb();\n        });\n      });\n    });\n  });\n}\n\n/**\n * Given a max w and h bounds, return the dimensions\n * of the largest 4x6 rect that will fit within.\n */\nCameraUtils.scale4x6 = function(maxw, maxh) {\n    var s0 = 6/4; // width / height\n    var s1 = maxw/maxh;\n\n    // Then the width is longer. Use the shorter side (height)\n    if (s0 <= s1) {\n        return {w: maxh * 6/4, h: maxh};\n    } else {\n        return {w: maxw, h: maxw * 4/6}\n    }\n}\n\nvar Config = {\n  photo_margin: 50, // Margin for the composite photo per side\n  window_width: $(window).width(),\n  window_height: $(window).height() - 10,\n  overlay_delay: 2000,\n  next_delay: 10000,\n  cheese_delay: 400,\n  flash_duration: 1000,\n  ready_delay: 3000,\n  nice_delay: 5000,\n\n  // The amount of time we should pause between each frame shutter\n  // I tend to bump this up when 1) photobooth participants want more\n  // time to review their photos between shots, and 2) when I'm shooting\n  // with external flash and the flash needs more time to recharge.\n  between_snap_delay: 1000,\n\n  // For usability enhancements on iPad, set this to \"true\"\n  is_mobile: true\n}\n\n/**\n * Describes the current state of the UI.\n */\nvar AppState = function() {\n  this.reset();\n};\n\nAppState.prototype.reset = function() {\n  this.current_frame_idx = 0;\n  this.zoomed = null;\n}\n\n/*\n * STATE MACHINE DEFINITION\n * Keep track of app state and logic.\n *\n * + loading\n *   - connected() -> ready\n * + ready\n *   - ui_button_pressed() (DOM button click) -> waiting_for_photo\n * + waiting_for_photo\n *   - photo_saved() -> review_photo\n * + review_photo\n *   - photo_updated() -> next_photo\n * + next_photo\n *   - continue_partial_set() -> waiting_for_photo\n *   - finish_set() -> ready\n *\n * @param [PhotoView]\n * @param [Socket]            The initialized Socket\n * @param [AppState] appState Global initialized state\n * @param [Config] config     The configuration options passed to the app\n */\nvar ShmileStateMachine = function (photoView, socket, appState, config, buttonView) {\n  this.photoView = photoView;\n  this.socket = socket;\n  this.appState = appState;\n  this.config = config;\n  this.buttonView = buttonView\n\n  var self = this;\n  isPrinting = false;\n\n  this.fsm = StateMachine.create({\n    initial: 'loading',\n    events: [\n      {name: 'connected', from: 'loading', to: 'ready'},\n      {name: 'ui_button_pressed', from: 'ready', to: 'waiting_for_photo'},\n      {name: 'photo_saved', from: 'waiting_for_photo', to: 'review_photo'},\n      {name: 'photo_updated', from: 'review_photo', to: 'next_photo'},\n      {name: 'continue_partial_set', from: 'next_photo', to: 'waiting_for_photo'},\n      {name: 'finish_set', from: 'next_photo', to: 'review_composited'},\n      {name: 'next_set', from: 'review_composited', to: 'ready'}\n    ],\n    callbacks: {\n      onconnected: function () {\n        self.photoView.animate('in', function () {\n          //self.buttonView.fadeIn();\n        });\n      },\n      onenterready: function () {\n        self.photoView.resetState();\n      },\n      onleaveready: function () {\n      },\n      onenterwaiting_for_photo: function (e) {\n        cheeseCb = function () {\n          self.photoView.modalMessage('Cheese!', self.config.cheese_delay);\n          self.photoView.flashStart();\n          self.socket.emit('snap', true);\n        }\n        CameraUtils.snap(self.appState.current_frame_idx, cheeseCb);\n\n        fallback = setTimeout(function() {\n          console.log('konnte kein bild aufnehmen')\n          self.photoView.flashEnd();\n          self.photoView.animate('out');\n          self.photoView.modalMessageBig('Die Kamera konnte kein Bild aufnehmen, bitte versuche es erneut!', 8000, 200, function () {\n            location.reload();\n          });\n        }, 15000)\n\n      },\n      onphoto_saved: function (e, f, t, data) {\n\n        clearTimeout(fallback);\n\n        // update UI\n        // By the time we get here, the idx has already been updated!!\n        self.photoView.flashEnd();\n        self.photoView.updatePhotoSet(data.web_url, self.appState.current_frame_idx, function () {\n          setTimeout(function () {\n            self.fsm.photo_updated();\n          }, self.config.between_snap_delay)\n        });\n      },\n      onphoto_updated: function (e, f, t) {\n        self.photoView.flashEnd();\n        // We're done with the full set.\n        if (self.appState.current_frame_idx == 3) {\n          self.fsm.finish_set();\n        }\n        // Move the frame index up to the next frame to update.\n        else {\n          self.appState.current_frame_idx = (self.appState.current_frame_idx + 1) % 4\n          self.fsm.continue_partial_set();\n        }\n      },\n      onenterreview_composited: function (e, f, t) {\n        self.socket.emit('composite');\n        self.photoView.showOverlay(true);\n        setTimeout(function () {\n          self.fsm.next_set()\n        }, self.config.next_delay);\n      },\n      onleavereview_composited: function (e, f, t) {\n        // Clean up\n        self.photoView.animate('out');\n        console.log('Drucken?');\n\n        $(window).bind('click', function () {\n\n          self.socket.emit('print', true);\n          $(this).unbind('click');\n\n          printtext.remove();\n          isPrinting = true;\n\n          self.photoView.modalMessageBig('Bild wird gedruckt, einen Augenblick geduld!', 15000, 200, function () {\n\n            //remove click handler\n            console.log('delete listener');\n            $(window).unbind('click');\n\n            /**\n             * Instead of loading next slide, do a reload\n             * for garbage collection.\n             */\n            //self.photoView.slideInNext();\n            location.reload();\n          });\n        });\n\n        var printtext = self.photoView.modalMessageBig('Drücke erneut um das Bild zu drucken!', 10000, 200, function () {\n\n          console.log('Printing: ' + isPrinting);\n\n          if(isPrinting) {\n            console.log('do nothing!');\n            return false;\n          }\n\n          //remove click handler\n          console.log('delete listener');\n          $(window).unbind('click');\n\n          /**\n           * Instead of loading next slide, do a reload\n           * for garbage collection.\n           */\n          location.reload();\n          //self.photoView.slideInNext();\n        });\n      },\n      onchangestate: function (e, f, t) {\n        console.log('fsm received event ' + e + ', changing state from ' + f + ' to ' + t)\n      }\n    }\n  });\n}\n\n/**\n * Proxy object that allows the late initialization of the socket, if one\n * exists at all. In instances where we never initialize the socket, we allow\n * for a fake Socket object using a Backbone Event channel.\n */\nvar SocketProxy = function() {\n  this.socket = null;\n  this.fakeSocket = {};\n  _.extend(this.fakeSocket, Backbone.Events)\n}\n\nSocketProxy.prototype.lateInitialize = function(socket) {\n  this.socket = socket;\n}\n\nSocketProxy.prototype.on = function(evt, cb) {\n  if (this.socket === null) {\n    console.log(\"SocketProxy 'on' delegating to fakeSocket\")\n    this.fakeSocket.on(evt, cb)\n    return\n  }\n  this.socket.on(evt, cb);\n}\n\nSocketProxy.prototype.emit = function(msg, data) {\n  if (this.socket === null) {\n    console.log(\"SocketProxy 'emit' delegating to fakeSocket\")\n    this.fakeSocket.trigger(msg, function() {\n      console.log(data)\n    });\n    return\n  }\n  this.socket.emit(msg, data);\n}\n\n/**\n * Responsible for initializing the connection to socket.io.\n * @param io [Socket]\n * @param fsm [StateMachine]\n */\nvar SocketLayer = function(io, proxy) {\n  this.io = io;\n  this.proxy = proxy;\n}\n\n/**\n * Attempt a connection to socket.io server.\n * If this fails, will no-op and silently continue.\n */\nSocketLayer.prototype.init = function() {\n  try {\n    this.socket = this.io.connect(\"/\");\n    this.proxy.lateInitialize(this.socket);\n  } catch(e) {\n    console.log(\"Error initializing socket connection: \" + e);\n  }\n  return this;\n}\n\n/**\n * Register bindings and callbacks.\n */\nSocketLayer.prototype.register = function(fsm) {\n  this.fsm = fsm;\n  var self = this;\n\n  this.proxy.on('message', function(data) {\n    console.log('message evt: data is:' + data);\n  });\n\n  this.proxy.on('connect', function() {\n    console.log('connected evt');\n    self.fsm.connected();\n  });\n\n  this.proxy.on('camera_snapped', function() {\n    console.log('camera_snapped evt');\n    //fsm.camera_snapped();\n  })\n\n  this.proxy.on('photo_saved', function(data) {\n    console.log('photo_saved evt: ' + data.filename);\n    self.fsm.photo_saved(data);\n  });\n\n  this.proxy.on('click', function(data) {\n    console.log('click event fired');\n    $(document).click();\n  });\n}\n\nvar PhotoView = Backbone.View.extend({\n  id: \"#viewport\",\n\n  initialize: function (config, state) {\n    this.config = config;\n    this.canvas = new Raphael('viewport', this.config.window_width, this.config.window_height);\n    this.frames = this.canvas.set(); // List of SVG black rects\n    this.images = this.canvas.set(); // List of SVG images\n    this.all = this.canvas.set();\n    this.overlayImage = null;\n    this.photoBorder = 0;\n    this.compositeDim = null;\n    this.frameDim = null;\n    this.compositeOrigin = null;\n    this.compositeCenter = null;\n    this.state = state;\n  },\n\n  render: function () {\n    var w = this.config.window_width - this.config.photo_margin;\n    var h = this.config.window_height - this.config.photo_margin;\n    this.compositeDim = CameraUtils.scale4x6(w, h);\n    this.compositeOrigin = {\n      x: (this.config.window_width - this.compositeDim.w) / 2,\n      y: (this.config.window_height - this.compositeDim.h) / 2\n    };\n    this.compositeCenter = {\n      x: this.compositeOrigin.x + (this.compositeDim.w / 2),\n      y: this.compositeOrigin.y + (this.compositeDim.h / 2)\n    }\n    var r = this.canvas.rect(this.compositeOrigin.x, this.compositeOrigin.y, this.compositeDim.w, this.compositeDim.h);\n\n    r.attr({'fill': 'white'});\n\n    this.all.push(r);\n\n    // Scale the photo padding too\n    this.photoBorder = this.compositeDim.w / 50;\n\n    //upper x\n    var frame_x = this.compositeOrigin.x + this.photoBorder;\n    var frame_y = this.compositeOrigin.y + this.photoBorder;\n    this.frameDim = {\n      w: (this.compositeDim.w - (3 * this.photoBorder)) / 2,\n      h: (this.compositeDim.h - (3 * this.photoBorder)) / 2\n    };\n    var frame = this.canvas.rect(frame_x, frame_y, this.frameDim.w, this.frameDim.h);\n    frame.attr({'fill': 'black'});\n    var img = this.canvas.image(null, frame_x, frame_y, this.frameDim.w, this.frameDim.h);\n\n    this.images.push(img);\n    this.frames.push(frame);\n    this.all.push(img);\n    this.all.push(frame);\n\n    frame = frame.clone();\n    img = img.clone();\n    frame.translate(this.frameDim.w + this.photoBorder, 0);\n    img.translate(this.frameDim.w + this.photoBorder, 0);\n    this.frames.push(frame);\n    this.images.push(img);\n    this.all.push(frame);\n    this.all.push(img);\n\n    frame = frame.clone();\n    img = img.clone();\n    frame.translate(-(this.frameDim.w + this.photoBorder), this.frameDim.h + this.photoBorder);\n    img.translate(-(this.frameDim.w + this.photoBorder), this.frameDim.h + this.photoBorder);\n    this.frames.push(frame);\n    this.images.push(img);\n    this.all.push(frame);\n    this.all.push(img);\n\n    frame = frame.clone();\n    img = img.clone();\n    frame.translate(this.frameDim.w + this.photoBorder, 0);\n    img.translate(this.frameDim.w + this.photoBorder, 0);\n    this.frames.push(frame);\n    this.images.push(img);\n    this.all.push(frame);\n    this.all.push(img);\n\n    // Draw the PNG logo overlay.\n    var o = this.canvas.image(\n      '/images/overlay.png',\n      this.compositeOrigin.x,\n      this.compositeOrigin.y,\n      this.compositeDim.w,\n      this.compositeDim.h);\n    this.all.push(o);\n    this.overlayImage = o;\n\n    // Hide everything and move out of sight.\n    this.all.hide();\n    this.all.translate(-this.config.window_width, 0);\n  },\n\n  toString: function () {\n    ret = [];\n    ret.push(\"Size of 'all' set: \" + this.all.length);\n    ret.push(\"Size of 'frames' set: \" + this.frames.length);\n    ret.push(\"Composite photo is: \" + this.all[0].attr('width') + 'x' + this.all[0].attr('height'));\n    ret.push(\"Frame photo is: \" + this.frameDim.w + 'x' + this.frameDim.h);\n    return ret.join('\\n');\n  },\n\n  /**\n   * Updates the image at the set location.\n   * @param {String} img_src\n   *   The URL of the image resource the browser should fetch and display\n   * @param {Integer} idx\n   *   Index of frame to update\n   * @param cb\n   *   The callback to be executed when the UI has finished updating and zooming out.\n   */\n  updatePhotoSet: function (img_src, idx, cb) {\n    var view = this;\n    var imgEl = view.images[idx];\n    var frameEl = view.frames[idx];\n\n    imgEl.attr({'src': img_src, 'opacity': 0});\n    imgEl.show();\n\n    var afterShowPhoto = function () {\n      // We've found and revealed the photo, now hide the old black rect and zoom out\n      frameEl.hide();\n      p.zoomFrame(idx, 'out', cb);\n    }\n    imgEl.animate({'opacity': 1}, 200, afterShowPhoto);\n  },\n\n  /**\n   * For in: assume the view has been rendered and reset to initial state and moved out of sight.\n   * Slide in the composite image.\n   * For out: assume the composite image is centered. Move out of sight and hide.\n   */\n  animate: function (dir, cb) {\n    if (dir === 'in') {\n      this.all.show();\n      this.images.hide();\n      this.overlayImage.hide();\n      this.all.animate({\n        'translation': this.config.window_width + \",0\"\n      }, 1000, \"<>\", cb);\n    } else if (dir === 'out') {\n      this.all.animate({\n        'translation': this.config.window_width + \",0\"\n      }, 1000, \"<>\", cb);\n    }\n  },\n\n  /**\n   * zoomFrame zooms into the indicated frame.\n   * Call it once to zoom in, call it again to zoom out.\n   *\n   * @param idx Frame index\n   *   Expect zoomFrame(1) to be matched immediately by zoomFrame(1)\n   * frame: 0 (upper left), 1 (upper-right), 2 (lower-left), 3 (lower-right)\n   * @param dir 'in' or 'out'\n   *   Zoom in or out\n   * @param onfinish\n   *   Callback executed when the animation is finished.\n   *\n   * Depends on the presence of the .zoomed object to store zoom info.\n   */\n  zoomFrame: function (idx, dir, onfinish) {\n    var view = this;\n    var composite = this.all[idx];\n\n    var frame = this.frames[idx];\n    var frameX = frame.attr('x');\n    var frameW = frame.attr('width');\n    var frameY = frame.attr('y');\n    var frameH = frame.attr('height');\n    var centerX = frameX + frameW / 2;\n    var centerY = frameY + frameH / 2;\n\n    var animSpeed = 700;\n\n    // delta to translate to.\n    var dx = this.compositeCenter.x - centerX;\n    var dy = this.compositeCenter.y - centerY;\n    var scaleFactor = this.compositeDim.w / this.frameDim.w;\n\n    if (dir === \"out\" && this.state.zoomed) {\n      scaleFactor = 1;\n      dx = -this.state.zoomed.dx;\n      dy = -this.state.zoomed.dy;\n      view.all.animate({\n        'scale': [1, 1, view.compositeCenter.x, view.compositeCenter.y].join(','),\n      }, animSpeed, 'bounce', function () {\n        view.all.animate({\n          'translation': dx + ',' + dy\n        }, animSpeed, '<>', onfinish)\n      });\n      // Clear the zoom data.\n      this.state.zoomed = null;\n    } else if (dir !== \"out\") {\n      view.all.animate({\n        'translation': dx + ',' + dy\n      }, animSpeed, '<>', function () {\n        view.all.animate({\n          'scale': [scaleFactor, scaleFactor, view.compositeCenter.x, view.compositeCenter.y].join(','),\n        }, animSpeed, 'bounce', onfinish)\n      });\n      // Store the zoom data for next zoom.\n      this.state.zoomed = {\n        dx: dx,\n        dy: dy,\n        scaleFactor: scaleFactor\n      };\n    }\n  },\n\n  /**\n   * Reset visibility, location of composite image for next round.\n   */\n  slideInNext: function () {\n    this.resetState();\n    this.modalMessage('Next!');\n    this.all.hide();\n    this.all.translate(-this.config.window_width * 2, 0);\n    this.animate('in', function () {\n      $(document).bind('click', function () {\n        $(document).trigger('ui_button_pressed');\n        $(this).unbind('click');\n      });\n    });\n  },\n\n  /**\n   * Resets the state variables.\n   */\n  resetState: function () {\n    this.state.reset();\n  },\n\n  /**\n   * Faux camera flash\n   */\n  flashEffect: function (duration) {\n    if (duration === undefined) {\n      duration = 200;\n    }\n    var rect = this.canvas.rect(0, 0, this.config.window_width, this.config.window_height);\n    rect.attr({'fill': 'white', 'opacity': 0});\n    rect.animate({'opacity': 1}, duration, \">\", function () {\n      rect.animate({'opacity': 0}, duration, \"<\");\n      rect.remove();\n    })\n  },\n\n  flashStart: function (duration) {\n    if (duration === undefined) {\n      duration = 200;\n    }\n    this.rect = this.canvas.rect(0, 0, this.config.window_width, this.config.window_height);\n    this.rect.attr({'fill': 'white', 'opacity': 0});\n    this.rect.animate({'opacity': 1}, duration, \">\")\n  },\n\n  flashEnd: function (duration) {\n    if (duration === undefined) {\n      duration = 200;\n    }\n    var self = this;\n    this.rect.animate({'opacity': 0}, duration, \"<\", function () {\n      self.remove();\n    });\n  },\n\n  /**\n   * Draws a modal with some text.\n   */\n  modalMessage: function (text, persistTime, animateSpeed, cb, fontSize) {\n    if (animateSpeed === undefined) {\n      var animateSpeed = 200;\n    }\n    if (persistTime === undefined) {\n      var persistTime = 500;\n    }\n\n    var sideLength = this.config.window_height * 0.3;\n    var x = (this.config.window_width - sideLength) / 2;\n    var y = (this.config.window_height - sideLength) / 2;\n    var all = this.canvas.set();\n    var r = this.canvas.rect(x, y,\n      sideLength,\n      sideLength,\n      15);\n    r.attr({\n      'fill': '#222',\n      'fill-opacity': 0.7,\n      'stroke-color': 'white'\n    });\n    all.push(r);\n    var txt = this.canvas.text(x + sideLength / 2, y + sideLength / 2, text);\n    txt.attr({\n      'fill': 'white',\n      'font-size': '50',\n      'font-weight': 'bold'\n    });\n    all.push(txt);\n    all.attr({'opacity': 0});\n    all.animate({\n      'opacity': 1,\n      'scale': '1.5,1.5',\n      'font-size': '70'\n    }, animateSpeed, '>');\n\n    // Timer to delete self nodes.\n    var t = setTimeout(function (all) {\n      // Delete nodes\n      txt.remove();\n      r.remove();\n      if (cb) cb();\n    }, persistTime, all);\n  },\n\n  /**\n   * Draws a modal with some text.\n   */\n  modalMessageBig: function (text, persistTime, animateSpeed, cb) {\n    if (animateSpeed === undefined) {\n      var animateSpeed = 200;\n    }\n    if (persistTime === undefined) {\n      var persistTime = 500;\n    }\n\n    var sideLength = this.config.window_height * 0.8;\n    var x = (this.config.window_width - sideLength) / 2;\n    var y = (this.config.window_height - sideLength) / 2;\n    var all = this.canvas.set();\n    var txt = this.canvas.text(x + sideLength / 2, y + sideLength / 2, text);\n    txt.attr({\n      'opacity': 0,\n      'fill': 'white',\n      'font-size': '10',\n      'font-weight': 'bold'\n    });\n    all.push(txt);\n    all.attr({'opacity': 0});\n    all.animate({\n      'opacity': 1,\n      'scale': '1.5,1.5',\n      'font-size': '50'\n    }, animateSpeed, '>');\n\n    // Timer to delete self nodes.\n    var t = setTimeout(function (all) {\n      // Delete nodes\n      txt.remove();\n      if (cb) cb();\n    }, persistTime, all);\n\n    return txt;\n  },\n\n  /**\n   * Applies the final image overlay to the composite image.\n   * This will usually contain the wedding logo: 24-bit transparent PNG\n   */\n  showOverlay: function (animate) {\n    this.overlayImage.show();\n    if (animate) {\n      //this.overlayImage.attr({'opacity':0});\n      this.overlayImage.animate({'opacity': 1}, this.config.overlay_delay);\n    }\n  },\n\n  /**\n   * Removes the overlay\n   */\n  hideOverlay: function (animate) {\n    var view = this;\n    if (animate) {\n      this.overlayImage.animate({'opacity': 0}, this.config.overlay_delay, function () {\n        view.overlayImage.hide();\n      });\n    } else {\n      this.overlayImage.hide();\n    }\n  }\n});\n\nvar ButtonView = function (fsm) {\n    this.fsm = fsm;\n}\n\nButtonView.prototype.render = function () {\n    var self = this;\n    // init code\n    // this.startButton = $('button#start-button');\n    // var buttonX = (Config.window_width - this.startButton.outerWidth())/2;\n    // var buttonY = (Config.window_height - this.startButton.outerHeight())/2;\n\n    // this.startButton.hide();\n\n    // Position the start button in the center\n    // this.startButton.css({'top': buttonY, 'left': buttonX});\n\n    //var buttonTriggerEvt = Config.is_mobile ? \"touchend\" : \"click\";\n\n    //trigger on mouse click\n    $(document).bind('click', function () {\n        $(document).trigger('ui_button_pressed');\n        $(this).unbind('click');\n    });\n\n    $(document).bind('ui_button_pressed', function () {\n        console.log('ui_button_pressed evt');\n        self.fsm.ui_button_pressed();\n    });\n}\n ButtonView.prototype.fadeIn = function() {\n  // this.startButton.fadeIn();\n}\n\n// Everything required to set up the app.\n$(window).ready(function () {\n\n  console.log('start');\n  var socketProxy = new SocketProxy();\n  var appState = new AppState();\n\n  window.io = window.io || undefined;\n\n  window.p = new PhotoView(window.Config, appState);\n  bv = new ButtonView();\n\n  var ssm = new ShmileStateMachine(window.p, socketProxy, appState, window.Config, bv)\n\n  bv.fsm = ssm.fsm\n\n  var layer = new SocketLayer(window.io, socketProxy)\n  layer.init();\n  layer.register(ssm.fsm);\n\n  window.socketProxy = socketProxy\n\n  bv.render();\n  p.render();\n});\n"]}